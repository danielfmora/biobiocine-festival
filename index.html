<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Festival - Pel√≠culas</title>
    <link rel="stylesheet" href="css/estilo.css">
</head>
<body>
    <header>
        <h1>üé¨ Gestor de Festival de Cine</h1>
        <nav>
            <a href="index.html">Pel√≠culas</a>
            <a href="calendario.html">Programaci√≥n</a>
            <a href="#" onclick="cerrarSesion()">Cerrar sesi√≥n</a>
        </nav>
    </header>
    <main>
        <h2>Pel√≠culas</h2>
        <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
            <button class="btn" onclick="abrirModalNueva()">‚ûï Nueva pel√≠cula</button>
            <input type="file" id="excelFile" accept=".xlsx, .xls" style="display: none;" onchange="importarExcel(event)">
            <button class="btn" onclick="document.getElementById('excelFile').click()">üì• Importar Excel</button>
            <button class="btn" onclick="exportarExcel()">üì§ Exportar Excel</button>
        </div>

        <!-- Configuraci√≥n de orden de columnas -->
        <div class="orden-columnas" id="orden-columnas"></div>

        <!-- Tabla de pel√≠culas -->
        <div class="tabla-container">
            <table id="tabla-peliculas">
                <thead id="thead-peliculas"></thead>
                <tbody id="tbody-peliculas"></tbody>
            </table>
        </div>
    </main>

    <!-- Modal nueva pel√≠cula -->
    <div id="modal-nueva" class="modal">
        <div class="modal-content">
            <h3>Nueva pel√≠cula</h3>
            <form id="form-nueva">
                <div class="form-group"><label>T√≠tulo</label><input id="titulo" required></div>
                <div class="form-group"><label>Director</label><input id="director"></div>
                <div class="form-group"><label>Pa√≠s</label><input id="pais"></div>
                <div class="form-group"><label>A√±o</label><input id="a√±o" type="number"></div>
                <div class="form-group"><label>Duraci√≥n (min)</label><input id="duracion" type="number"></div>
                <div class="form-group"><label>Sinopsis</label><textarea id="sinopsis"></textarea></div>
                <div class="form-group"><label>P√≥ster (imagen)</label><input id="imagen" type="file" accept="image/*"></div>
                <button type="button" class="btn btn-success" onclick="guardarNueva()">Guardar</button>
                <button type="button" class="btn" onclick="cerrarModal('modal-nueva')">Cancelar</button>
            </form>
        </div>
    </div>

    <!-- Modal editar pel√≠cula -->
    <div id="modal-editar" class="modal">
        <div class="modal-content">
            <h3>Editar pel√≠cula</h3>
            <input type="hidden" id="edit-id">
            <div class="form-group"><label>T√≠tulo</label><input id="edit-titulo"></div>
            <div class="form-group"><label>Director</label><input id="edit-director"></div>
            <div class="form-group"><label>Pa√≠s</label><input id="edit-pais"></div>
            <div class="form-group"><label>A√±o</label><input id="edit-a√±o" type="number"></div>
            <div class="form-group"><label>Duraci√≥n</label><input id="edit-duracion" type="number"></div>
            <div class="form-group"><label>Sinopsis</label><textarea id="edit-sinopsis"></textarea></div>
            <button type="button" class="btn btn-success" onclick="guardarEdicion()">Guardar</button>
            <button type="button" class="btn" onclick="cerrarModal('modal-editar')">Cancelar</button>
        </div>
    </div>

    <script type="module">
        import { auth } from './js/firebase-config.js';
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { cargarPeliculas, agregarPelicula } from './js/peliculas.js';
        import { cambiarOrden } from './js/peliculas.js';
        import './js/excel.js';
        import './js/auth.js';

        onAuthStateChanged(auth, (user) => {
            if (!user) {
                window.location.href = 'login.html';
            } else {
                cargarPeliculas();
                initDragAndDropOrden();
            }
        });

        window.abrirModalNueva = () => {
            document.getElementById('modal-nueva').style.display = 'block';
        };

        window.cerrarModal = (id) => {
            document.getElementById(id).style.display = 'none';
        };

        window.guardarNueva = async () => {
            const formData = {
                titulo: document.getElementById('titulo').value,
                director: document.getElementById('director').value,
                pais: document.getElementById('pais').value,
                a√±o: document.getElementById('a√±o').value,
                duracion: document.getElementById('duracion').value,
                sinopsis: document.getElementById('sinopsis').value
            };
            const imagenFile = document.getElementById('imagen').files[0];
            await agregarPelicula(formData, imagenFile);
            cerrarModal('modal-nueva');
            // limpiar formulario
            document.getElementById('form-nueva').reset();
        };

        // Para ordenar columnas con drag & drop (simple)
        function initDragAndDropOrden() {
            // Esta funci√≥n se llamar√° despu√©s de cargar las pel√≠culas
            // Crear lista de campos arrastrables
        }
    </script>
</body>
</html>